# a16n Documentation Site

Docusaurus-based documentation site for the a16n project.

## Local Development

### Quick Start (Prose Only)

Fast development server for editing prose documentation:

```bash
pnpm start
```

This runs Docusaurus in dev mode **without** generating API docs. Perfect for authoring content.

### Local Development with Current API

To preview docs with **current working directory API** (see docs for your WIP code):

```bash
pnpm start:full
```

This generates API docs from your current code at `/api/current` and starts the dev server. Fast (~30 seconds).

**Use this when:** Working on a feature branch and need to see API docs for unreleased code.

### Production Build (Versioned API Only)

To build the complete site with all versioned API documentation:

```bash
# Build with all versioned API docs (from git tags ONLY)
pnpm build

# Serve the built site locally
pnpm serve
```

Visit `http://localhost:3000` to browse the site.

**Note:** Production builds take ~4-5 minutes as they generate API docs for every tagged version.
**CI uses this:** The CI workflow runs `pnpm build`, which ONLY generates docs from git tags (no current/WIP code).

## Authoring Content

### Prose Documentation

Edit files in `docs/`:
- `docs/intro.md` - Landing page
- `docs/cli/index.md` - CLI guide
- `docs/engine/index.md` - Engine guide
- etc.

Use standard Markdown or MDX. Changes are hot-reloaded in `pnpm start`.

### API Documentation

API docs are **auto-generated** from TypeScript source code using TypeDoc.

**Two modes:**

1. **Local dev (`apidoc:current`):** Generates docs from current working directory → `/api/current`
   - Used by `pnpm start:full`
   - See docs for your work-in-progress code
   - Fast (~30 seconds)

2. **Production (`apidoc:versioned`):** Generates docs for every git tag
   - Used by `pnpm build` (CI uses this)
   - Implemented in `scripts/generate-versioned-api.ts`
   - Creates `/api/0.4.0`, `/api/0.3.0`, etc.
   - Slow (~4 minutes)

**Do not edit** files in `.generated/` - they are regenerated on each build.

**Implementation notes:**
- TypeDoc generates a `README.md` for each version's root - we rename these to `index.md` with proper frontmatter (versioned only)
- Curated indexes with descriptions are maintained in `api.mdx` wrapper pages

### Version Picker

The VersionPicker component is embedded in each package's API Reference page (`docs/*/api.mdx`).

It will only work in builds that generate `versions.json`:
- ✅ `pnpm build:versioned` - Full versioned docs
- ✅ CI builds - Uses `build:versioned` 
- ❌ `pnpm build` - Current version only, no versions.json
- ❌ `pnpm start:full` - Dev mode, no versions.json

## Build Scripts

| Script | Purpose |
|--------|---------|
| `pnpm start` | Dev server (prose only, ~5s) |
| `pnpm start:full` | Dev server with current API (~30s) |
| `pnpm build` | Production build - versioned API from tags ONLY (~4min) |
| `pnpm serve` | Serve built site locally |
| `pnpm apidoc:current` | Generate API from working directory (local dev only) |
| `pnpm apidoc:versioned` | Generate API from all git tags (CI uses this) |
| `pnpm test` | Run tests for build scripts |

**Important:** `build` (used by CI) generates ONLY from git tags. `start:full` (local dev) generates from current code.

## Structure

```
packages/docs/
├── docs/               # Hand-written prose (COMMITTED)
│   ├── intro.md
│   ├── cli/
│   │   ├── index.md    # CLI guide
│   │   └── api.mdx     # API landing page with VersionPicker
│   ├── models/
│   │   ├── index.md    # Models guide
│   │   └── api.mdx     # API landing page with VersionPicker
│   └── ...
├── .generated/         # Staging area (GITIGNORED)
│   ├── intro.md        # Copied from docs/
│   ├── cli/
│   │   ├── index.md
│   │   ├── api.mdx
│   │   └── api/        # Generated by TypeDoc
│   │       ├── latest/ # Symlink (versioned builds only)
│   │       └── 0.3.0/  # Tagged version (versioned builds only)
│   └── ...
├── build/              # Final static site (GITIGNORED)
├── static/
│   └── versions.json   # Version manifest (generated, gitignored)
├── scripts/
│   └── generate-versioned-api.ts  # Versioned API generator
└── src/
    └── components/
        └── VersionPicker/  # Version dropdown component
```

## Workflow

1. **Edit prose**: Modify `docs/**/*.md` files
2. **Preview**: Run `pnpm start` (fast, no API docs needed)
3. **Full check**: Run `pnpm build && pnpm serve` to verify
4. **Commit**: Only commit `docs/` changes (not `.generated/` or `build/`)
5. **Deploy**: CI runs `pnpm build:versioned` and deploys to GitHub Pages

## Configuration

- `docusaurus.config.js` - Docusaurus configuration
- `sidebars.js` - Sidebar structure
- `typedoc.json` - TypeDoc base config (for current API docs)
- `typedoc.versioned.json` - TypeDoc config for versioned docs (with path mappings)

## Troubleshooting

### "VersionPicker not showing"

The VersionPicker requires `versions.json` to exist. Run `pnpm build:versioned` instead of `pnpm build`.

### "API docs not updating"

API docs are cached in `.generated/`. To regenerate:

```bash
pnpm stage && pnpm apidoc
```

Or just delete `.generated/` - it will be regenerated on next build.

### "Build is slow"

For local development, use `pnpm start` (no API docs) or `pnpm build` (current API only).

Only use `pnpm build:versioned` when you need to test versioned docs or before pushing.
